<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Skeleton PWA</title>
    <link rel="manifest" href="manifest.webmanifest" />
  </head>
  <body>
    <main>
      <h1>Skeleton PWA</h1>
      <p id="status">Deployed? Next step is Spotify auth.</p>
      <button id="login">Log in with Spotify</button>
      <button id="play" disabled>Play sample</button>
      <button id="pause" disabled>Pause</button>
      <div id="now"></div>
    </main>

    <!-- Spotify Web Playback SDK -->
    <script src="https://sdk.scdn.co/spotify-player.js"></script>

    <script type="module">
      import { ensureAuth, getAccessTokenSync } from './auth.js';
      import { initPlayer, startPlayback, pause } from './player.js';

      const status = document.getElementById('status');
      const loginBtn = document.getElementById('login');
      const playBtn = document.getElementById('play');
      const pauseBtn = document.getElementById('pause');

      loginBtn.onclick = async () => { await ensureAuth(); };

      window.onSpotifyWebPlaybackSDKReady = async () => {
        const token = getAccessTokenSync();
        if (!token) {
          status.textContent = 'Click “Log in with Spotify” first.';
          return;
        }
        status.textContent = 'Initializing player…';

        const { deviceId, player } = await initPlayer(() => getAccessTokenSync());
        status.textContent = `Device ready: ${deviceId}`;

        playBtn.disabled = false;
        pauseBtn.disabled = false;

        // Must be triggered by a user gesture
        playBtn.onclick = () =>
          startPlayback(deviceId, { uris: ['spotify:track:3n3Ppam7vgaVa1iaRUc9Lp'] }); // example
        pauseBtn.onclick = () => pause(player);
      };
    </script>
  </body>
</html>
